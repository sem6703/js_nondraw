<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/x-icon" href="data:image/gif;base64,R0lGODlhEAAQAPcAAAkYLAocNxQyWy1PkUtntS1etSRasxY/hRcwZSQtXDo1aD0yYjg3XQ8XLgcNGQ4WIwseOQ0mTyRNjl9wzImJ2ECA0WKb7Q5QqRtBhiM2b0RCf1FDhkJBahAbNQMLFQ8aLg4nTAgkUBpFfXmv6Zax4Umb2oTD8gA9jxVEfhY/eS84b0E5aUREbxkoSQYUKgwbMAkjSgEdSg1BfEGR3FeQ3SSG4W268gA4jgo4chJCfRcoXD06Y2ZVfCUxVQseNw8kPwYjTQIiXRJJiy5/11Oc8E6m7n/E9AJUsQc7eEV0qQktaDxAc2RVgCgyWhAlQhYwTggvXwEkYhVPkR5swjmR6nfS9IfK9GKs5q/H3a3I4ggybxolXC0pURQkRi5CWkBXcwo1bgM2dxtgqTuW7X3A9+D2+c3M87LL7ztzrkd5sHWQvI2Pwci026+wy4KauEpnhQw+egU8g2uo3dXo//T09//g+eng983g+rPC8r238Lev2oF9plRMbBcpTDdahTxjhRBEgw9JkYa86Ovz//Pu9f/y+fD1+sjr+KvA8LjQ8IagvkFSjCorYwciVTpolGV/mws5dAAtdRpmr4O98sXj8PX/+N/x95vV8Zy/3Mbf8/////Dr88rH0XeNrDpiiShLcQs0agMtan6hzbDJ9oe98XHP+nK78xJ22AE5igE7iRk9gGlwo19lgmB/qWGCnmx8k0lkicjW7IOkwhxRmihzyDqa737D9iR4zBJBhRNJkCVOllprpgogUCZHfgQwWxcxUwsjShMwYgAnYwU3fS9owzeS63W89gdRpBZEgk5nrHNyr25moUlUiElaig8vUBYrSQoiSAQdRgk3aCBFjkxvyi2L21uo7AAzhCtJin1pp/fP2rGFrHp2mDRJehAZNg4fOgwiQgohSh1BfVRLqb+T5V9/z3ia5hJGmD5YlWNNgcSdv4Roois1Yis+cAUULA8eNgoaMxEkSDJGg4l2xuvZ83J800RvyiFQnTVEd1NQfHBomFJPfzU1WEVHeBojQRkfNyH/C05FVFNDQVBFMi4wAwEAAAAh+QQFewCaACwAAAAAEAAQAAAI/wABQAABAwgUMHAAQQIFCxg0cPACRAgRI0iUMHECRQoVK1i0cPEESBAhQ4gUMXIESRIlS5g0cfIGTBgxY8iUMXMGTRo1a9i0cfMIUCBBgwgVMnQIUSJFixg1cvQKVChRo0iVMnUKVSpVq1i1cvUMWDBhw4gVM3YMWTJly5g1c/YOXDhx48iVM3cOXTp169i1c/cQYECBAwkWNHgQYUKFCxk2dPgSZEiRI0mWNHkSZUqVK1m2dPkUaFChQ4kWNXoUaVKlS5k2dfoWbFixY8mWNXsWbVq1a9m2dfsYcGDBgwkXNnwYcWLFixk3dvwadGjRo0mXNn0adWrVq1m3dv0ceCRw4cOJFzd+HHly5cuZN3f+Hnx48ePJlzd/Hn169evZt3f/BAQAOw==">


 
  
  <title>Non-draw</title>
  <style>
  *:not(hr), *::after, *::before {box-sizing: border-box;margin:0;padding:0;border:0}ul {list-style-type: none}
#i{padding: 0px 0;display: inline-block;background: linear-gradient(rgba(0,0,0,0.9), blue); 
text-align: center;
}
.hide{display:none}

label{margin:2px; padding: 7px; display: inline-block; background:#ded;border:2px solid green; cursor: pointer;}
  .palet {display:flex;}
  .palet .color {width:24px; height:24px;background: white;border:1px solid blue;}
#pascal{margin:10px;padding-left: 33px;border: 1px solid blue;width:fit-content;
position: relative;} 
.copybara {
transition: .5s ease-out;
position:absolute;
right:0px;
top: 2px;
b0ackground-color:yellow;
/* ******************* */
	background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAATCAIAAAAS8MqlAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAEsSURBVDhPnZC9TsMwFIV5RXZ4BF6BjpHYwgQrCxLpEDEQJ6FlohJMaQOoQvyUhZaGspHE8U+55lbErU0j9egosm/O5yN76zsvNrDCTg09Pb/oIdMLbK4Jtp3O5XrSjsE3iqI1ZI2lb5+9x2wuZRzHwIRhSAjRo7qX2iRAUsKiZegiCOxYOoK2KelP2rdjyP2esxCS3e6VBZNSSCG44CDEVLWaCdy6rvtH1thglPWGU5JMvJt3zB2cP+x7d1wIx3GAQa1icCpWMc4Qg4kacg7r2dcMbMEGr9n18CNIxmfLbXsn6e5xf/swgYkF04UYY7xiVVVRCqYlTFYxXb7v123te9V2ZGszDW8AIdVBS1oWpXLejMFvbGt5qm3HejfTiJlqxv4TBuxYozfC8uIHUDp6oFBQcH0AAAAASUVORK5CYII=);
	background-size: cover;
	cursor: pointer;
	width: 27px;
	height: 30px;
	margin-left:-27px;
	margin-bottom:20px;	
} 
.copybara:hover {transform: scale(1.1); border: 1px solid blue;}
#waw{display: block; height:32px; background: green;}
#waw:has(#curve:checked){background: red;} 
#curve{display:none;}
.doo{opacity: 0.5;}
  </style>  
</head>
<body text="black" bgcolor="white">


<div id=i>
<svg id="svg" width="900" height="415" viewBox="0 0 900 415" fill="none"
onmousedown="
if(curve.checked){
	const o={// вершина ломаной добавление/выделение
		x:stepx*(Math.round((event.clientX-i.offsetLeft
		+window.pageXOffset)/stepx)),
		y:stepy*(Math.round((event.clientY-i.offsetTop
		+window.pageYOffset)/stepy))
	};	

	// попал в заповедную зону
	let g=-1;// нарушитель
	for (let i=0;i<a.length;i++)if(((a[i].x-o.x)*(a[i].x-o.x)+(a[i].y-o.y)*(a[i].y-o.y))<160)g=i;
	if (g>-1)
		{
			c=g;	
			vw();
		}
		else
		{
			a.push(o);
			c=a.length-1;
			bz.push(true);	
			vw();
		}
}
else{
	dawn['down']=true;
	dawn.x=stepx*(Math.floor((event.clientX-i.offsetLeft)/stepx)); 
	dawn.y=stepy*(Math.floor((event.clientY-i.offsetTop)/stepy));
	eff.setAttribute('x',dawn.x);
	eff.setAttribute('y',dawn.y);
	eff.classList.remove('hide');
}
"

onmousemove="
if(curve.checked){}
else{
	if(dawn['down']){
	let x=stepx*(Math.floor((dawn.x-event.clientX+i.offsetLeft)/stepx));
	let y=stepy*(Math.floor((dawn.y-event.clientY+i.offsetTop)/stepy));
	eff.setAttribute('width',Math.abs(x));
	eff.setAttribute('height',Math.abs(y));
	dawn.w=Math.abs(x);
	dawn.h=Math.abs(y);
	}
}
"
onmouseup="
if(curve.checked){}
else{
	dawn['down']=false;
	eff.classList.add('hide');
	let x=stepx*(Math.floor((dawn.x-event.clientX+i.offsetLeft)/stepx));
	let y=stepy*(Math.floor((dawn.y-event.clientY+i.offsetTop)/stepy));

	//console.log(['up',dawn.x,dawn.y,Math.abs(x),Math.abs(y)].join(','));

	if(document.getElementById('ute'))ute.remove();
	svg.innerHTML+=
		`<rect id='ute' x='`
		+dawn.x+`' y='`
		+dawn.y+`' width='`
		+dawn.w+`' height='`
		+dawn.h+`' stroke='red' `
		+`stroke-width='1' fill='none'></rect>`;
	move=0;
}
"

>
<style type="text/css">
.rect1, .polygon1 {stroke: blue;}
.txt1 {font-family: Arial; font-size: 12px; line-height: 0; fill:white;}
textPath {font-family: sans-serif; font-size: 16px;}
</style>
<rect class="x" x="0" y="0" width="900" height="415" fill="#ded"></rect>

<g id="grid1"></g>




<ellipse class="x" cx="462.5" cy="302.5" rx="49.5" ry="10" stroke="blue" fill="cyan" opacity="1" stroke-width="1"></ellipse>
<g id="figs"></g>
<g id="gogo"></g>

<rect id="eff" class="hide" x="0" y="0" width="90" height="41" stroke="red" fill="none"></rect>


</svg>
</div><br>
<label onclick="but00()">rest</label>
<label onclick="but01()">round</label>
<label onclick="but05()">romb</label>
<!-- <label onclick="but2()">line /</label>
<label onclick="but3()">line \</label> -->
<label onclick="but04();
a=[];c=-1;gogo.innerHTML='';
">clip</label>
<label onclick="but10();
a=[];c=-1;gogo.innerHTML='';
">bezie</label>
<label onclick="a=[];c=-1;gogo.innerHTML='';// стирает путь">clear path</label>
<label onclick="grid()">grid</label>
<label onclick="del()">&times;</label>


<label onclick="but06()">male</label>
<label onclick="but07()">female</label>
<label onclick="but08()">fial</label>
<label onclick="but09()">runcap</label>


 <article class="palet">
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div><br>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>
	<div class="color"></div>	
	<div class="color"></div>	
</article>

<label id="waw">
<input id="curve" type="checkbox" onchange="if(document.getElementById('ute'))ute.remove();"  />
<!--  checked  -->
</label>
<div style=""></div>
<div id="pascal">

<div class="copybara" 
onclick="cpy(this.parentElement);">
</div>
</div>
<textarea id="cop" rows="1" cols="90" style="position:absolute; left:-9999px; color: white; background: green;" title="используется для копирования">
</textarea>


<script>/*
<h1 id="h1"></h1>onchang
<h2 id="h2"></h2>
<h3 id="h3"></h3>
*/
let a=[]; // коорды в пикселях
let b=[]; // коорды в процентах
let bf=[]; // коорды в пикселях
let bz=[]; // сглаженность точки
let c=-1;  // курсор точек
let s;
let datax, datay;
let stepx=1,stepy=1;
let gxmi,gymi,gwidth,gheight;

let au=[];// dawno тека
let bok=0;
const cc=['white','red','black','green','yellow','lime',
'violet','purple','navy','aqua','blue','gold',
'teal','olive','maroon','silver','springgreen','#6c757d','fuchsia'];
let move=null;
let n=0;
let ink=cc[4];
let dawn={x:0,y:0,w:1,h:1};// знакоместо



const adi=()=>{// пиксели в проценты
	let xma,xmi,yma,ymi,dx,dy;
	let kx,ky;
	if (!a.length) return [];
	xma=a[0].x; yma=a[0].y;
	xmi=a[0].x; ymi=a[0].y;
	a.forEach(i=>{
		if(xma<i.x)xma=i.x;
		if(yma<i.y)yma=i.y;
		if(xmi>i.x)xmi=i.x;
		if(ymi>i.y)ymi=i.y;
		dx=xma-xmi;
		dy=yma-ymi;
		kx=dx/100;
		ky=dy/100;	
		});
	return a.map(i=>{return {
		x:Math.trunc((i.x-xmi)/kx),
		y:Math.trunc((i.y-ymi)/ky),
		}});
}

const fre=()=>{// пиксели не в проценты
	let xma,xmi,yma,ymi,dx,dy;
	let kx,ky;
	if (!a.length) return [];
	xma=a[0].x; yma=a[0].y;
	xmi=a[0].x; ymi=a[0].y;
	a.forEach(i=>{
		if(xma<i.x)xma=i.x;
		if(yma<i.y)yma=i.y;
		if(xmi>i.x)xmi=i.x;
		if(ymi>i.y)ymi=i.y;
		dx=xma-xmi;
		dy=yma-ymi;
		//kx=dx/100;
		//ky=dy/100;	
		});
	gxmi=xmi;
	gymi=ymi;
	gwidth=dx;
	gheight=dy;	
	return a.map(i=>{return {
		x:i.x-xmi,//Math.trunc())
		y:i.y-ymi,//Math.trunc())
		}});
}

const vw=()=>{ // рендеринг вершин ломаной
    b=adi();
	bf=fre();
	//h3.innerText=b.map(i=>i.x+' '+i.y).join(',');
	s=a.map((i,j)=>
	'<circle r="3" cx="'+(i.x)+
	'" cy="'+(i.y)+
	'" fill="'+((bz[j])?'red':'fuchsia')+'"/>'	
	).join('\n');
	gogo.innerHTML=	
	'<rect x="'+(a[c].x-5)+'" y="'+(a[c].y-5)+'" width="10" height="10" fill="none" stroke="red"/>'
	+s;	
}

//** увел  с https://prog-time.ru/kak-uznat-ton-tsveta-po-kodu-na-javascript/
function colorToRGBA(color) {// название цвета в rgb
    var cvs, ctx;
    cvs = document.createElement('canvas');
    cvs.height = 1;
    cvs.width = 1;
    ctx = cvs.getContext('2d');
    ctx.fillStyle = color;
    ctx.fillRect(0, 0, 1, 1);
    return ctx.getImageData(0, 0, 1, 1).data;
}

const brushcolor=(x)=>{
	let c=colorToRGBA(x.getAttribute('fill'));
	return `SetBrushColor(rgb(${c[0]},${c[1]},${c[2]}));`;
}
const strokecolor=(x)=>{
	let c=colorToRGBA(x.getAttribute('stroke'));
	return `SetPenColor(rgb(${c[0]},${c[1]},${c[2]}));`;
}

const pas=()=>{// pascalabc.net код 
	let bc,pc;
	pascal.innerHTML=
'uses graphABC;<br>'+	
'begin<br>'+
'	SetPenWidth(3);<br>'+
'	SetPenColor(clBlack);<br>'+	
	au.map((x,i)=>{		
		delete x['down'];
		let s='';
		let d;
		if(!x)return '';// нулевой эл всегда пустой
		if(x['x']<0)return '';// удаленая фигура х=-1
		d=document.getElementById('p'+i);//(i+1)//
		if(d){// полигон
			bc=brushcolor(d);
			pc=strokecolor(d);
			s=d.getAttribute('d').replace(/[^\d-,]/g,'').split(',');
			let a=[];
			xx=0,yy=0;
			for(let j=0; j<s.length; j+=2){
				xx+=+s[j];
				yy+=+s[j+1];
				a.push('('+xx+','+yy+')');
			}	
			let e=bc+pc+'Polygon('+a.join(',')+');<br>';
			//let e=bc+'Polyline('+a.join(',')+','+a[0]+');<br>';
			return e;
		}
		d=document.getElementById('e'+i);////(i+1)
		if(d){//эллипс
			bc=brushcolor(d);
			let rx=+d.getAttribute('rx');
			let cx=+d.getAttribute('cx');
			let ry=+d.getAttribute('ry');
			let cy=+d.getAttribute('cy');					
			let e=bc+'Ellipse('+[(cx-rx),(cy-ry),(cx+rx),(cy+ry)].join(',')+');<br>';
			return e;
		}
		d=document.getElementById('r'+i);////(i+1)
		if(d){//прямоугольник
			bc=brushcolor(d);
			let rx=+d.getAttribute('x');
			let ry=+d.getAttribute('y');
			let cx=+d.getAttribute('width');
			let cy=+d.getAttribute('height');					
			let e=bc+'Rectangle('+[(rx),(ry),(cx+rx),(cy+ry)].join(',')+');<br>';
			return e;
		}
		d=document.getElementById('ll'+i);////(i+1)
		if(d){//line
			bc=strokecolor(d);
			let x1=+d.getAttribute('x1');
			let y1=+d.getAttribute('y1');
			let x2=+d.getAttribute('x2');
			let y2=+d.getAttribute('y2');					
			let e=bc
			+'Moveto('+x1+','+y1+'); '
			+'Lineto('+x2+','+y2+');<br>';
			return e;
		}		
		let m=[];
		for (const p in x)  m.push(`${p}: ${x[p]}`);	 
		return m.join('')+s+'<br>';})// end of map au
	.join('')
+'end.<br>'	;
pascal.innerHTML+=
'<div class="copybara" '
+'onclick="cpy(this.parentElement);">'
+'</div>';
}

//***************
jp=[...document.querySelectorAll('.color')];
jp.forEach((x,i)=>{
	x.style.background=cc[i]; 
	x.addEventListener('click',()=>{
		ink=cc[i];
	});
});


//*******************************
const but00=()=>{// прямоугольник
	n++;
	if(document.getElementById('ute'))ute.remove();// id='mov'
	//svg.innerHTML+=
	figs.innerHTML+=
		`<rect class="fg"  id='r`
		+n+`' x='`
		+dawn.x+`' y='`
		+dawn.y+`' width='`
		+dawn.w+`' height='`
		+dawn.h+`' fill='`
		+ink+`' stroke='black' stroke-width='1' `
		+` onmouseup="event.stopPropagation();" `
		+` onmousemove="event.stopPropagation();" `
		+` onmousedown="if(!curve.checked){event.stopPropagation();} `
		+` if(document.getElementById('ute'))ute.remove(); `
		//alert(`+n+`);
		+` den0(this); `
		+`move=`
		+n+`;bok=0;"></rect>`;
	au[n]={};for (let key in dawn){au[n][key] = dawn[key];}
	bok=0;
	console.log(au);
	pas();
	move=n;
	}//

const but01=()=>{
	n++;
	if(document.getElementById('ute'))ute.remove();
	//svg.innerHTML+=
	figs.innerHTML+=
		`<ellipse class="fg" id='e`+n+`' rx="`
		+(dawn.w/2)+`" ry="`
		+(dawn.h/2)+`" cx="`
		+(dawn.x+dawn.w/2)+`" cy="`
		+(dawn.y+dawn.h/2)+`" fill="`
		+ink+`"  stroke='black' stroke-width='1' `
		+` onmouseup="event.stopPropagation();" `
		+` onmousemove="event.stopPropagation();" `
		+` onmousedown="if(!curve.checked){event.stopPropagation();} `
		+` if(document.getElementById('ute'))ute.remove(); `
		+` den1(this); `
		+`move=`
		+n+`;bok=0;"></ellipse>`;
	au[n]={};for (let key in dawn){au[n][key] = dawn[key];}
	bok=0;
	pas();
	move=n;
	}

const but04=()=>{// полигон
	n++;
	let px,py;
	// прогон через проценты копит погрешности
	//let a10=b.map(i=>{return {x:(dawn.x+i.x*dawn.w/100),y:(dawn.y+i.y*dawn.h/100)}});
	if (!document.querySelector('ute')){//alert('need help')
		dawn.x=gxmi;
		dawn.y=gymi;
		dawn.w=gwidth;
		dawn.h=gheight;
		}
	let a10=bf.map(i=>{return {x:(dawn.x+i.x),y:(dawn.y+i.y)}});

	let a11=a10.map((j,k)=>{let o={x:(j.x-px),y:(j.y-py)};px=j.x;py=j.y;return (k===0)?j:o});
	let a12=a11.map(v=>(v.x|0)+','+(v.y|0)).join(',');
	//console.log(a12);
	if(document.getElementById('ute'))ute.remove();
	//svg.innerHTML+=
	if(a10.length>2){
	figs.innerHTML+=
		`<path class="fg" id='p`+n+`' d="m`
		+a12
		+`z" fill="`
		+ink+`"  stroke='black' stroke-width='1' `
		+` data-x='`
		+(a11[0].x|0)
		+`' data-y='`
		+(a11[0].y|0)+`' `
		+` onmouseup="event.stopPropagation();" `
		+` onmousemove="event.stopPropagation();" `
		+` onmousedown="if(!curve.checked){event.stopPropagation();} `
		+` if(document.getElementById('ute'))ute.remove(); `
		+` den4(this,`+n+`); `
		+`move=`
		+n+`; bok=0;"></path>\r\n`;//</ellipse>`;
		}
	if(a10.length===2){//alert('line')
	figs.innerHTML+=
		`<line  class="fg" id='ll`+n+`'  x1="`
		+(a11[0].x|0)+`" y1="`
		+(a11[0].y|0)+`" x2="`
		+((a11[0].x|0)+(a11[1].x|0))+`" y2="`
		+((a11[0].y|0)+(a11[1].y|0))+`" stroke="`
		+ink+`" stroke-linecap="square" stroke-width="5" `
		+` onmouseup="event.stopPropagation();" `
		+` onmousemove="event.stopPropagation();" `
		+` onmousedown="if(!curve.checked){event.stopPropagation();} `
		+` if(document.getElementById('ute'))ute.remove(); `
		+` den3(this); `
		+`move=`
		+n+`;bok=0;"></line>`;		
		}	
	au[n]={};for (let key in dawn){au[n][key] = dawn[key];}
	bok=0;
	pas();
	move=n;// dont work
	}


const but05=()=>{// ромб
	n++;
	let px,py;
	b=[{x:0,y:50},{x:50,y:0},{x:100,y:50},{x:50,y:100}];
	let a10=b.map(i=>{
		return {
			x:(dawn.x+i.x*dawn.w/100),
			y:(dawn.y+i.y*dawn.h/100)
		}});
	let a11=a10.map((j,k)=>{
		let o={x:(j.x-px),y:(j.y-py)};
		px=j.x;
		py=j.y;
		return (k===0)?j:o}
		);
	let a12=a11.map(v=>(v.x|0)+','+(v.y|0)).join(',');

	if(document.getElementById('ute'))ute.remove();
	//svg.innerHTML+=
	figs.innerHTML+=
		`<path class="fg" id='p`+n+`' d="m`
		+a12
		+`z" fill="`
		+ink+`"  stroke='black' stroke-width='1' `
		+` data-x='`
		+(a11[0].x|0)
		+`' data-y='`
		+(a11[0].y|0)+`' `
		+` onmouseup="event.stopPropagation();" `
		+` onmousemove="event.stopPropagation();" `
		+` onmousedown="if(!curve.checked){event.stopPropagation();} `
		+` if(document.getElementById('ute'))ute.remove(); `
		+` den4(this,`+n+`); `
		+`move=`
		+n+`;bok=0;"></path>\r\n`;//</ellipse>`;
	au[n]={};for (let key in dawn){au[n][key] = dawn[key];}
	bok=0;
	pas();
	move=n;
	}
	

const but06=()=>{// самец
	n++;
	let px,py;
	//b=[{x:0,y:50},{x:50,y:0},{x:100,y:50},{x:50,y:100}];
	b=[{x:0,y:0},{x:100,y:0},{x:50,y:100}];	
	let a10=b.map(i=>{
		return {
			x:(dawn.x+i.x*dawn.w/100),
			y:(dawn.y+i.y*dawn.h/100)
		}});
	let a11=a10.map((j,k)=>{
		let o={x:(j.x-px),y:(j.y-py)};
		px=j.x;
		py=j.y;
		return (k===0)?j:o}
		);
	let a12=a11.map(v=>(v.x|0)+','+(v.y|0)).join(',');

	if(document.getElementById('ute'))ute.remove();
	//svg.innerHTML+=
	figs.innerHTML+=
		`<path class="fg" id='p`+n+`' d="m`
		+a12
		+`z" fill="`
		+ink+`"  stroke='black' stroke-width='1' `
		+` data-x='`
		+(a11[0].x|0)
		+`' data-y='`
		+(a11[0].y|0)+`' `
		+` onmouseup="event.stopPropagation();" `
		+` onmousemove="event.stopPropagation();" `
		+` onmousedown="if(!curve.checked){event.stopPropagation();} `
		+` if(document.getElementById('ute'))ute.remove(); `
		+` den4(this,`+n+`); `
		+`move=`
		+n+`;bok=0;"></path>\r\n`;//</ellipse>`;
	au[n]={};for (let key in dawn){au[n][key] = dawn[key];}
	bok=0;
	pas();
	move=n;
	}	
	
	

const but07=()=>{// самка
	n++;
	let px,py;
	b=[{x:50,y:0},{x:100,y:100},{x:0,y:100}];	
	let a10=b.map(i=>{
		return {
			x:(dawn.x+i.x*dawn.w/100),
			y:(dawn.y+i.y*dawn.h/100)
		}});
	let a11=a10.map((j,k)=>{
		let o={x:(j.x-px),y:(j.y-py)};
		px=j.x;
		py=j.y;
		return (k===0)?j:o}
		);
	let a12=a11.map(v=>(v.x|0)+','+(v.y|0)).join(',');

	if(document.getElementById('ute'))ute.remove();
	//svg.innerHTML+=
	figs.innerHTML+=
		`<path class="fg" id='p`+n+`' d="m`
		+a12
		+`z" fill="`
		+ink+`"  stroke='black' stroke-width='1' `
		+` data-x='`
		+(a11[0].x|0)
		+`' data-y='`
		+(a11[0].y|0)+`' `
		+` onmouseup="event.stopPropagation();" `
		+` onmousemove="event.stopPropagation();" `
		+` onmousedown="if(!curve.checked){event.stopPropagation();} `
		+` if(document.getElementById('ute'))ute.remove(); `
		+` den4(this,`+n+`); `
		+`move=`
		+n+`;bok=0;"></path>\r\n`;//</ellipse>`;
	au[n]={};for (let key in dawn){au[n][key] = dawn[key];}
	bok=0;
	pas();
	move=n;
	}	
	
const but08=()=>{// фиал
//dawn.w=300; dawn.h=260; dawn.x=160; dawn.y=100;
	n++;
	let px,py;
	b=[
{x:67,y:100,c:false},	
	
{x:-34,y:0,c:false},//{x:34,y:100,c:false},
{x:18,y:-35,c:true},  
{x:-80,y:-35,c:false},  
{x:-32,y:-100,c:false}, 
   
{x:16,y:13,c:true},    
{x:32,y:13,c:false},     
{x:48,y:13,c:false},     
{x:16,y:0,c:true}, 
{x:32,y:0,c:false},
       
{x:50,y:-14,c:false},      
{x:46,y:64,c:true}, //16   
{x:-50,y:64,c:false},     
{x:-32,y:100,c:false},		
	];	
	let tx=dawn.x, ty=dawn.y;
	let a10=b.map((i,j)=>{
		return {
			x:(((j)?0:tx)+i.x*dawn.w/100),//dawn.x+
			y:(((j)?0:ty)+i.y*dawn.h/100),//dawn.y+
			c: i.c,
		}});
	let a11=a10.map((j,k)=>{
		//let o={x:(j.x-px),y:(j.y-py),c:j.c};
		let o={x:(j.x),y:(j.y),c:j.c};
		px=j.x;
		py=j.y;
		return (k===0)?j:o}
		);
	a11[5]['y']=11;	a11[6]['y']=11;a11[7]['y']=11;
	a11[8]['y']=0;a11[9]['y']=0;a11[10]['y']=-12;
	let a12=a11.map(v=>((v.c)?'c':'')+(v.x|0)+','+(v.y|0)).join(',');

	if(document.getElementById('ute'))ute.remove();
	//svg.innerHTML+=
	figs.innerHTML+=
		`<path class="fg" id='p`+n+`' d="m`
		+a12
		+`z" fill="`
		+ink+`"  stroke='black' stroke-width='1' `
		+` data-x='`
		+(a11[0].x|0)
		+`' data-y='`
		+(a11[0].y|0)+`' `
		+` onmouseup="event.stopPropagation();" `
		+` onmousemove="event.stopPropagation();" `
		+` onmousedown="if(!curve.checked){event.stopPropagation();} `
		+` if(document.getElementById('ute'))ute.remove(); `
		+` den4(this,`+n+`); `
		+`move=`
		+n+`;bok=0;"></path>\r\n`;//</ellipse>`;
	au[n]={};for (let key in dawn){au[n][key] = dawn[key];}
	bok=0;
	pas();
	move=n;
	}	


const but09=()=>{// чаша
	n++;
	let px,py;
	b=[
{x:50,y:100,c:false},	
	
{x:-10,y:-10,c:false},//{x:34,y:100,c:false},
{x:-35,y:-35,c:true},  
{x:-70,y:-35,c:false},  //-80
{x:-40,y:-90,c:false}, 
   
{x:16,y:13,c:true},    
{x:32,y:13,c:false},     
{x:50,y:13,c:false},     
{x:16,y:0,c:true}, 
{x:32,y:0,c:false},
       
{x:50,y:-14,c:false},      
{x:20,y:55,c:true}, //30  
{x:-5,y:55,c:false},     
{x:-40,y:90,c:false},		
	];	
	let tx=dawn.x, ty=dawn.y;
	let a10=b.map((i,j)=>{
		return {
			x:(((j)?0:tx)+i.x*dawn.w/100),//dawn.x+
			y:(((j)?0:ty)+i.y*dawn.h/100),//dawn.y+
			c: i.c,
		}});
	let a11=a10.map((j,k)=>{
		//let o={x:(j.x-px),y:(j.y-py),c:j.c};
		let o={x:(j.x),y:(j.y),c:j.c};
		px=j.x;
		py=j.y;
		return (k===0)?j:o}
		);
	a11[5]['y']=11;	a11[6]['y']=11;a11[7]['y']=11;
	a11[8]['y']=0;a11[9]['y']=0;a11[10]['y']=-12;
	let a12=a11.map(v=>((v.c)?'c':'')+(v.x|0)+','+(v.y|0)).join(',');

	if(document.getElementById('ute'))ute.remove();
	//svg.innerHTML+=
	figs.innerHTML+=
		`<path class="fg" id='p`+n+`' d="m`
		+a12
		+`z" fill="`
		+ink+`"  stroke='black' stroke-width='1' `
		+` data-x='`
		+(a11[0].x|0)
		+`' data-y='`
		+(a11[0].y|0)+`' `
		+` onmouseup="event.stopPropagation();" `
		+` onmousemove="event.stopPropagation();" `
		+` onmousedown="if(!curve.checked){event.stopPropagation();} `
		+` if(document.getElementById('ute'))ute.remove(); `
		+` den4(this,`+n+`); `
		+`move=`
		+n+`;bok=0;"></path>\r\n`;//
	au[n]={};for (let key in dawn){au[n][key] = dawn[key];}
	bok=0;
	pas();
	move=n;
	}	
	
const but10=()=>{// безье
	n++;
	let px,py;
	// прогон через проценты копит погрешности
	//let a10=b.map(i=>{return {x:(dawn.x+i.x*dawn.w/100),y:(dawn.y+i.y*dawn.h/100)}});
	if (!document.querySelector('ute')){//alert('need help')
		dawn.x=gxmi;
		dawn.y=gymi;
		dawn.w=gwidth;
		dawn.h=gheight;
		}
	let a10=bf.map(i=>{return {x:(dawn.x+i.x),y:(dawn.y+i.y)}});	
	
	//alert(a10.length);
if (a10.length%3===0){
//alert('lox');
a10.push(a10[0]);
}	
	
	let a11=a10.map((j,k)=>{let o={x:(j.x-px),y:(j.y-py)};px=j.x;py=j.y;return (k===0)?j:o});
	px=a10[0].x;py=a10[0].y;
	//let a14=a10.map((j,k)=>{let o={x:(px-j.x),y:(py-j.y)};return (k===0)?j:o});	//
	let a14=a10.map((j,k)=>{

		let o={x:(j.x-px),y:(j.y-py)};
		if(k%3===0){px=j.x;py=j.y;}	
			console.log([px,py]);
		return (k===0)?j:o});	//	
	let a12=a14.map(v=>(v.x|0)+','+(v.y|0)).join(',');
	let a13=a12.split(/,/g)[0]+', '+a12.split(/,/g)[1]+', c'+a12.split(/,/g).slice(2).join(',');
	//alert(a12);
	//alert(a13);
	//console.log(a12);
	if(document.getElementById('ute'))ute.remove();
	//svg.innerHTML+=
	if(a10.length>2){
	figs.innerHTML+=
		`<path class="fg" id='p`+n+`' d="m`
		//+a12
		+a13
		+`z" fill="`
		+ink+`"  stroke='black' stroke-width='1' `
		+` data-x='`
		+(a11[0].x|0)
		+`' data-y='`
		+(a11[0].y|0)+`' `
		+` onmouseup="event.stopPropagation();" `
		+` onmousemove="event.stopPropagation();" `
		+` onmousedown="if(!curve.checked){event.stopPropagation();} `
		+` if(document.getElementById('ute'))ute.remove(); `
		+` den4(this,`+n+`); `
		+`move=`
		+n+`; bok=0;"></path>\r\n`;//</ellipse>`;
		}
		/*
	if(a10.length===2){//alert('line')
	figs.innerHTML+=
		`<line  class="fg" id='ll`+n+`'  x1="`
		+(a11[0].x|0)+`" y1="`
		+(a11[0].y|0)+`" x2="`
		+((a11[0].x|0)+(a11[1].x|0))+`" y2="`
		+((a11[0].y|0)+(a11[1].y|0))+`" stroke="`
		+ink+`" stroke-linecap="square" stroke-width="5" `
		+` onmouseup="event.stopPropagation();" `
		+` onmousemove="event.stopPropagation();" `
		+` onmousedown="if(!curve.checked){event.stopPropagation();} `
		+` if(document.getElementById('ute'))ute.remove(); `
		+` den3(this); `
		+`move=`
		+n+`;bok=0;"></line>`;		
		}	*/
	au[n]={};for (let key in dawn){au[n][key] = dawn[key];}
	bok=0;
	pas();
	move=n;// dont work
	}

		

const grid=()=>{// создает сетку
	grid1.innerHTML='';
	let xx=0;
	let dx, dy;
	if(dawn.x+dawn.y){dx=dawn.w; dy=dawn.h;}else{dx=10; dy=10;}

	while(xx<900){
	grid1.innerHTML+=
	'<path d="M'+xx+' 0 V420" stroke="gray" stroke-width="1"></path>\r\n';
	xx+=2*dx;}
	let yy=0;
	while(yy<420){
	grid1.innerHTML+=
	'<path d="M0 '+yy+' H900" stroke="gray" stroke-width="1"></path>\r\n';
	yy+=2*dy;}
	stepx=dx; stepy=dy;
}

const del=()=>{
	if(move){
		let a=[...document.querySelectorAll('.fg')];
		//**дамнотека
		au[move]['x']=-1;
		console.log(au[move]);//
		//***свг
		a[move-1].style.display='none';
		//***
		move=0;
	}
	bok=0;
	pas();
}

//***********************************
const den0=(n)=>{ // квадрат
dawn.x=n.getAttribute('x');
dawn.y=n.getAttribute('y');
dawn.w=n.getAttribute('width');
dawn.h=n.getAttribute('height');
}
const den1=(n)=>{ // круг
dawn.x=n.getAttribute('cx')-n.getAttribute('rx');
dawn.y=n.getAttribute('cy')-n.getAttribute('ry');
dawn.w=2*n.getAttribute('rx');
dawn.h=2*n.getAttribute('ry');
}

const den3=(n)=>{// линия
dawn.x=n.getAttribute('x1');
dawn.y=n.getAttribute('y1');
dawn.w=n.getAttribute('x2')+n.getAttribute('x1');
dawn.h=n.getAttribute('y2')+n.getAttribute('y1');
}
const den4=(n)=>{// полигон
dawn={};for (let key in au[n]){dawn[key] = au[n][key];}
}
 //********************* выбранная точка перемещается курсорными клавишами
 document.addEventListener('keydown', (e) => {// ←↑↓→
	// сканирование клавы 
	let hx,hy;
	//h1.innerText=move;
	if(move)
		if(document.getElementById('ute'))
			ute.remove();
	switch(e.key) {//
		case 'ArrowDown': //↓
			if(curve.checked){
				if(c+1){a[c].y+=stepy; vw();}// точки ломаной			
			}
			else{
			hx=0;hy=stepy;
			switch (bok){// подвижная грань
				case 2: dawn.h=+dawn.h+stepy; break;//низ
				case 4: dawn.y=+dawn.y+stepy; 
						dawn.h=+dawn.h-stepy; 
						break;//верх
				case 0: dawn.y=+dawn.y+stepy; break;//все
				}			
				}
				e.preventDefault();
				break;
				
		
		case 'ArrowUp': //↑
			if(curve.checked){
				if(c+1){a[c].y-=stepy; vw();}
			}
			else{
			hx=0;hy=-stepy;
			switch (bok){
				case 2: dawn.h=+dawn.h-stepy; break;//низ
				case 4: dawn.y=+dawn.y-stepy; dawn.h=+dawn.h+stepy; break;//верх
				case 0: dawn.y=+dawn.y-stepy; break;//все
				}					
				}
				e.preventDefault();
				break;
						  
		case 'ArrowRight': //→
			if(curve.checked){
				if(c+1){a[c].x+=stepx; vw();}
			}
			else{
			hx=stepx;hy=0;
			switch (bok){
				case 1: dawn.w=+dawn.w+stepx; break;//правая
				case 3: dawn.x=+dawn.x+stepx; dawn.w=+dawn.w-stepx; break;//левая
				case 0: dawn.x=+dawn.x+stepx; break;//все
				}
				}
				e.preventDefault();
				break;
					
		case 'ArrowLeft': //←
			if(curve.checked){
				if(c+1){a[c].x-=stepx;	vw();}
			}
			else{
			hx=-stepx;hy=0;
			switch (bok){
				case 1: dawn.w=+dawn.w-stepx; break;
				case 3: dawn.x=+dawn.x-stepx; dawn.w=+dawn.w+stepx; break;
				case 0: dawn.x=+dawn.x-stepx; break;
				}
				}
				e.preventDefault();
				break;
		case ' ': //but01();break;//	alert('space')			
		         curve.click();

		case '0': if(!curve.checked){bok++;bok=bok%5;
			/*switch (bok){// подвижная грань
				case 1: hx=stepx; hy=0; break;
				case 2: hx=0; hy=stepy; break;//низ
				case 3: hx=-stepx; hy=0; break;
				case 4: hx=0; hy=-stepy; break;//верх
				}*/
			switch (bok){// подвижная грань
				case 0: hx=0; hy=0; break;
				case 1: hx=0; hy=0; break;
				case 2: hx=0; hy=0; break;//низ
				case 3: hx=0; hy=0; break;
				case 4: hx=0; hy=0; break;//верх
				}				
		}// numpad0	, 0	
		default: break;
	}// switch
	//h2.innerText=bok; // перемещаемая грань знакоместа


	if(document.getElementById('ute')){	
		ute.setAttribute('x',dawn.x);
		ute.setAttribute('y',dawn.y);	
		ute.setAttribute('width',dawn.w);
		ute.setAttribute('height',dawn.h);
		pas();
		return; 
	}	

	let b;// искомый элемент
	b=document.querySelector('#r'+move);// квадрат
	if (b)
		{	
		b.setAttribute('x',dawn.x);
		b.setAttribute('y',dawn.y);	
		b.setAttribute('width',dawn.w);
		b.setAttribute('height',dawn.h);
		pas();
		return;
		}
	b=document.querySelector('#e'+move);// круг
	if (b)
		{	
		b.setAttribute('cx',dawn.x+dawn.w/2);
		b.setAttribute('cy',dawn.y+dawn.h/2);	
		b.setAttribute('rx',dawn.w/2);
		b.setAttribute('ry',dawn.h/2);
		pas();
		return;
		}
	b=document.querySelector('#p'+move);// полигон
	if (b)
		{	
		datax=+b.dataset.x+hx;
		datay=+b.dataset.y+hy;
		if(isNaN(datax)){return;}//alert('nan');
		b.dataset.x=datax;// иногда масштбирование помещает сюда NaN
		b.dataset.y=datay;			
		let s=b.getAttribute('d').replace(/(m\d+,\d+)(.+)/,'$2');
		b.setAttribute('d','m'+datax+','+datay+s);
		pas();
		return;
		}
	});
//**************************

const cpy=x=>{ // копирование в буфер обмена
	const cop=document.querySelector('#cop');
	cop.value=pascal.innerText;
	cop.select();
	document.execCommand('copy');
} 
//*****************************************************************//
</script>   
</body>
</html>